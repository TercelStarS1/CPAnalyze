<!DOCTYPE html>
<html> 
<head>
    <title></title>
    <link rel="import" href="TemplateHead.html" >
    <link rel="stylesheet" href="../ResourceYC/resource/css/start.css" >
</head> 
<body class="hold-transition skin-blue sidebar-mini">
    <div class="wrapper">
        <div class="content-wrapper" id="contentdiv">
            <section class="content-header" style="border-bottom:2px solid grey;">
                <h1 id="showaction">猪类预测</h1>
                <ol class="breadcrumb">
                    <li>
                        <a href="StarHome.html"><i class="fa fa-dashboard"></i> 主页</a>
                    </li>
                    <li class="active">项目风险预测</li>

                </ol>
            </section>
            <div class="pad margin no-print" style="padding-bottom:0px; margin-bottom:0px; min-width:800px;">
                <div class="row" style="padding-left:10px;">
                    <div style="display:flex"> 
                        <button id="btn_add" class="btn btn-blue" style="margin-left:20px;"  data-toggle="modal">
                             <i class="fa fa-plus"></i>新建项目
                        </button> 
                    </div>
                </div>
                <div style="border:1px solid grey; color:black; border-radius:10px; margin:10px;  display:flex;">
                    <div style="margin-top:12px; padding-left:15px;">
                        <h4>假定条件:</h4> 
                    </div>
                    <div style="margin-top:10px;  padding-left:15px;">
                        <p>进栏日龄：21天  &nbsp;&nbsp;&nbsp;&nbsp;重6.5KG</p>
                        <p>出栏日龄：174天 &nbsp;&nbsp;重120KG</p>
                    </div>
                    <div  style="margin-top:17px;  padding-left:25px;">
                        <button id="btn_slbz" class="btn btn-info" data-toggle="modal">
                            <i class="fa fa-star-o"></i>生长及耗料标准  
                        </button>
                        <button id="btn_ymbz" class="btn btn-info" style="margin-left:20px; " data-toggle="modal">
                            <i class="fa fa-star-o"></i>疫苗使用标准
                        </button>
                        <button id="btn_stbz" class="btn btn-info" style="margin-left:20px; " data-toggle="modal">
                            <i class="fa fa-star-o"></i>死淘曲线  
                        </button> 
                    </div> 
                </div>
            </div>
            <section class="content">
                <div id="divshow" class="col-md-12">

                </div>
                <div class="col-md-12 "> 
                    <div class="panel panel-blue">
                        <div class="panel-heading">项目列表</div>
                        <div class="panel-body table-responsive">
                            <table class="table table-striped table-bordered table-hover">
                                <thead>
                                    <tr> 
                                        <th>项目名称</th> 
                                        <th>创建日期</th>
                                        <th id="cjz">创建人</th>
                                        <th>头数</th>
                                        <th>详情</th>
                                        <th>预测</th>
                                    </tr>
                                </thead>
                                <tbody id="xmlist"> 
                                </tbody>
                            </table>
                        </div>
                    </div> 
                </div>
                <div class="col-md-12" style="width:95%;">
                    <ul id="fyshow" style="float:right;"></ul>
                </div> 
        </section>
        
        </div> 
    </div>
    <!--新建及项目详情-->
    <div class="modal fade" id="showXM" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog"  style="width:1250px;" >
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                        &times;
                    </button>
                    <h4 class="modal-title" id="myModalLabel">
                        新建项目
                    </h4>
                </div>
                <div class="modal-body" style="height:630px; margin-bottom:10px;"> 
                    <div class="col-md-12 divhead">
                        <span style="font-size:16px; font-weight:600; margin-right:20px;">养殖水平评估: </span>
                        <span>养殖头数</span>
                        <input id="yzNum" type="text" maxlength='8' class="form-control">
                        <span>单头代养费</span>
                        <input id="yzDYF" type="text" maxlength='8'  class="form-control">
                        <span>死淘率(%)</span> 
                        <div class="input-group spinner">
                            <input type="text" class="form-control" maxlength='4' id="yzSTL">
                            <div class="input-group-btn-vertical">
                                <button class="btn btn-default" type="button"><i class="fa fa-caret-up"></i></button>
                                <button class="btn btn-default" type="button"><i class="fa fa-caret-down"></i></button>
                            </div>
                        </div>
                        <span>一等猪率(%)</span>
                        <div class="input-group spinner">
                            <input type="text" id="yzYDL" maxlength='4' class="form-control" >
                            <div class="input-group-btn-vertical">
                                <button class="btn btn-default" type="button"><i class="fa fa-caret-up"></i></button>
                                <button class="btn btn-default" type="button"><i class="fa fa-caret-down"></i></button>
                            </div>
                        </div>  
                        <span>非一等猪均重比率(%)</span>
                        <div class="input-group spinner">
                            <input type="text" id="noRa" maxlength='4' class="form-control">
                            <div class="input-group-btn-vertical">
                                <button class="btn btn-default" type="button"><i class="fa fa-caret-up"></i></button>
                                <button class="btn btn-default" type="button"><i class="fa fa-caret-down"></i></button>
                            </div>
                        </div>
                        <span>非一等猪价格比率(%)</span>
                        <div class="input-group spinner">
                            <input type="text" id="noWGT" maxlength='4' class="form-control">
                            <div class="input-group-btn-vertical">
                                <button class="btn btn-default" type="button"><i class="fa fa-caret-up"></i></button>
                                <button class="btn btn-default" type="button"><i class="fa fa-caret-down"></i></button>
                            </div>
                        </div>   
                         
                    </div>
                    <div class="col-md-12 table" style="margin-top:10px; border-radius:10px; display:flex;"> 
                        <div class="col-md-6 ">
                            <div class="panel panel-blue" >
                                <div class="panel-heading">饲料</div>
                                <div class="panel-body">
                                    <table class="table table-striped table-bordered table-hover">
                                        <thead>
                                            <tr>
                                                <th>料种</th>
                                                <th>饲料厂成本(元/kg)</th>
                                                <th>养殖公司成本(元/kg)</th>
                                                <th>代养户成本(元/kg)</th>
                                            </tr>
                                        </thead>
                                        <tbody id="sltbale">
                                            
                                        </tbody>
                                    </table>
                                </div>
                            </div> 
                            <div class="panel panel-blue">
                                <div class="panel-heading">药品</div>
                                <div class="panel-body">
                                    <table class="table table-striped table-bordered table-hover">
                                        <thead>
                                            <tr>
                                                <th>名称</th>
                                                <th>养殖公司成本(元/头)</th>
                                                <th>代养户成本(元/头)</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td>药品</td>
                                                <td style="padding:0px;"><input id="YPCB" maxlength='8'  type="text" class="form-control"></td>
                                                <td style="padding:0px;"><input id="YPHT" maxlength='8'  type="text" class="form-control"></td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div> 
                        <div class="col-md-6">
                            <div class="panel panel-blue" >
                                <div class="panel-heading">猪苗</div>
                                <div class="panel-body" style="padding-bottom:1px;">
                                    <table class="table table-striped table-bordered table-hover">
                                        <thead>
                                            <tr> 
                                                <th>名称</th>
                                                <th>养殖公司成本(元/头)</th>
                                                <th>代养户成本(元/头)</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr> 
                                                <td>猪苗</td>
                                                <td style="padding:0px;"><input id="ZMCB" maxlength='8' type="text" class="form-control"></td>
                                                <td style="padding:0px;"><input id="ZMHT" maxlength='8' type="text" class="form-control"></td>
                                            </tr> 
                                        </tbody>
                                    </table>
                                </div>
                            </div> 
                            <div class="panel panel-blue" >
                                <div class="panel-heading">疫苗</div>
                                <div class="panel-body" style="padding-bottom:5px;">
                                    <table class="table table-striped table-bordered table-hover">
                                        <thead>
                                            <tr>
                                                <th>疫苗</th>
                                                <th>名称</th>
                                                <th>养殖公司成本(元/次)</th>
                                                <th>代养户成本(元/次)</th>
                                            </tr>
                                        </thead>
                                        <tbody id="ymtable"></tbody>
                                    </table>
                                </div>
                            </div>
                            <div class="panel panel-blue">
                                <div class="panel-heading">成品猪</div>
                                <div class="panel-body" style="padding-bottom:1px; padding-top:9px;">
                                    <table class="table table-striped table-bordered table-hover">
                                        <thead>
                                            <tr>
                                                <th>名称</th>
                                                <th>市场价(元/kg)</th>
                                                <th>合同价(元/kg)</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td>成品猪</td>
                                                <td style="padding:0px;"><input type="text" id="CPSC" maxlength='8' class="form-control"></td>
                                                <td style="padding:0px;"><input type="text" id="CPHT" maxlength='8' class="form-control"></td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>  
                </div> 
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">
                        关闭
                    </button>
                    <button type="button" id="btnShowTB" class="btn btn-success">
                        预测
                    </button>
                </div>
            </div> 
        </div> 
    </div>
    <!--利润预测-->
    <div class="modal fade" id="showLRYC" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog" style="width:1000px; height:750px;">
            <div class="modal-content">
                
                <div class="modal-body">
                    <div class="col-md-12 divhead" style="margin:12px; margin-left:90px; width:800px;">
                        <span style="font-size:16px; font-weight:600; margin-right:20px;">养殖水平评估: </span>
                        <span>死淘率(%)</span>
                        <div class="input-group spinner">
                            <input type="text" class="form-control" maxlength='4' id="yzSTL1">
                            <div class="input-group-btn-vertical">
                                <button class="btn btn-default" type="button"><i class="fa fa-caret-up"></i></button>
                                <button class="btn btn-default" type="button"><i class="fa fa-caret-down"></i></button>
                            </div>
                        </div>
                        <span>一等猪率(%)</span>
                        <div class="input-group spinner">
                            <input type="text" id="yzYDL1" maxlength='4' class="form-control">
                            <div class="input-group-btn-vertical">
                                <button class="btn btn-default" type="button"><i class="fa fa-caret-up"></i></button>
                                <button class="btn btn-default" type="button"><i class="fa fa-caret-down"></i></button>
                            </div>
                        </div>
                        <span>市场价</span>
                        <div class="input-group spinner">
                            <input type="text" id="noRa1" maxlength='4' class="form-control">
                            <div class="input-group-btn-vertical">
                                <button class="btn btn-default" type="button"><i class="fa fa-caret-up"></i></button>
                                <button class="btn btn-default" type="button"><i class="fa fa-caret-down"></i></button>
                            </div>
                        </div> 
                        <button type="button" id="btnYC" style="height:36px; margin:7px;" class="btn btn-success">
                            预测
                        </button>
                    </div>
                    <div id="lrtb" style="width:900px;height:500px"></div>
                </div>
                <div class="modal-footer" style="border:0px; padding:35px;">
                     
                </div>
            </div>
        </div>
    </div>    
    <!--生长曲线-->
    <div class="modal fade" id="showSZBZ" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog" style="width:800px;">
            <div class="modal-content">
                <div class="modal-body">
                    <div class="panel panel-blue" style="padding:0px; margin:0px; margin-bottom:15px;">
                        <div class="panel-heading">生长及耗料标准</div>
                        <div class="panel-body">
                            <table class="table table-striped table-bordered table-hover">
                                <thead>
                                    <tr style="display:block;">
                                        <th>日龄</th>
                                        <th>标准重</th>
                                        <th>日增重</th>
                                        <th>饲料</th>
                                        <th>耗料</th>
                                        <th>日耗料</th>
                                    </tr>
                                </thead>
                                <tbody id="szqxtr"> 
                                </tbody>
                                
                            </table>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">
                        关闭
                    </button>
                </div>
            </div>
        </div>
    </div>   
    <!--疫苗使用标准-->
    <div class="modal fade" id="showYMBZ" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog" style="width:800px;">
            <div class="modal-content"> 
                <div class="modal-body">
                    <div class="panel panel-blue" style="padding:0px; margin:0px; margin-bottom:15px;">
                        <div class="panel-heading">疫苗使用标准</div>
                        <div class="panel-body">
                            <table class="table table-striped table-bordered table-hover">
                                <thead>
                                    <tr>
                                        <th>日龄</th>
                                        <th>疫苗</th>
                                        <th>名称</th>
                                        <th>数量</th>
                                    </tr>
                                </thead>
                                <tbody id="ymtr"> 
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">
                        关闭
                    </button> 
                </div>
            </div>
        </div>
    </div>    
    <!--死淘曲线-->
    <div class="modal fade" id="showSTQX" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog" style="width:1000px;">
            <div class="modal-content"> 
                <div class="modal-body">
                    <div id="ttqx" style="width:95%;height:450px"></div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">
                        关闭
                    </button> 
                </div>
            </div>
        </div>
    </div>    
    

    <script type="text/javascript">   
        var NEWORADD = 0; //0新建  1编辑
        var pageshownum = 15;  //每页展示数据量
        var numall = 0;   //总数据量 
        var projectID = "";
        //下拉加减1
        $('.spinner .btn:first-of-type').on('click', function () {
            var endnum = parseFloat($(this).parent().prevAll('input').val()) + 0.1;
            $(this).parent().prevAll('input').val(endnum.toFixed(1)); 
        });
        $('.spinner .btn:last-of-type').on('click', function () {
            var endnum = parseFloat($(this).parent().prevAll('input').val()) - 0.1;
            $(this).parent().prevAll('input').val(endnum.toFixed(1));
            
        });
        $("#showXM").delegate("input", "keyup", function () {
            clearNoFloat(this);
        }); 
        $("#yzNum").keyup(function () {
            clearNoNum(this);
        });
        
        //新建项目
        $("#btn_add").click(function () {
            NEWORADD = 0;
            $('#showXM').modal({ backdrop: "static" });
            $.ajax({
                type: "Post",
                url: "/api/STD/NewProject",
                dataType: 'json',
                beforeSend: function(){
                    if (!xval) {
                        GetAjaxLoad("", "");
                    }
                },
                success: function (data) { 
                    //饲料数据
                    var slhtml = "";
                    var sllist = data.data.sllist;
                    console.log(sllist);
                    for (var i = 0; i < sllist.length; i++) {
                        slhtml +="<tr>"+
                                " <td>" + sllist[i].CODE + "</td>" +   
                                "<td style='padding:0px;'><input  type='text' maxlength='8' vid=" + sllist[i].ID + " value='" + sllist[i].FEEDFAC + "' class='form-control'></td>" +
                                "<td style='padding:0px;'><input  type='text' maxlength='8' value='" + sllist[i].MANAGEMENT + "' class='form-control'></td>" +
                                "<td style='padding:0px;'><input  type='text' maxlength='8' value='" + sllist[i].FARM + "' class='form-control'></td>" +
                                "</tr> "; 
                    }
                    $('#sltbale').html(slhtml);
                    //疫苗数据
                    var ymlist = data.data.ymlist; 
                    var ymhtml = "";
                    for (var i = 0; i < ymlist.length; i++) {
                        ymhtml += " <tr>" +
                                "<td>" + ymlist[i].CODE + "</td>" +
                                "<td>" + ymlist[i].NAME + "</td>" +
                                "<td style='padding:0px;'><input type='text' maxlength='8' style='border:none; text-align:right;' vid=" + sllist[i].ID + "  value='" + ymlist[i].MANAGEMENT + "' class='form-control'></td>" +
                                "<td style='padding:0px;'><input type='text' maxlength='8' style='border:none; text-align:right;' value='" + ymlist[i].FARM + "' class='form-control'></td>" +
                            "</tr> "; 
                    }
                    $('#ymtable').html(ymhtml);
                    // 猪苗  ZMCB  ZMHT
                    $('#ZMCB').val(data.data.zmlist[0].MANAGEMENT);
                    $('#ZMHT').val(data.data.zmlist[0].FARM);
                    // 药品  YPCB  YPHT
                    $('#YPCB').val(data.data.yplist[0].MANAGEMENT);
                    $('#YPHT').val(data.data.yplist[0].FARM);
                    // 成品  CPSC  CPHT
                    $('#CPSC').val(data.data.zzlist[0].MARKET);
                    $('#CPHT').val(data.data.zzlist[0].CONTRACT);
                    //  进猪数量   代养费   死淘   一级
                    $('#yzNum').val(data.data.rllist[0].PIGLETQTY);
                    $('#yzDYF').val(data.data.rllist[0].ADJUSTFEE);
                    $('#yzSTL').val(data.data.rllist[0].CULLINGRATE);
                    $('#yzYDL').val(data.data.rllist[0].PERFECTRATE);
                    $('#noRa').val(data.data.rllist[0].NOPERFWGTRATE);
                    $('#noWGT').val(data.data.rllist[0].NOPERFPRICERATE); 
                },
                complete: function () {
                    if (xval) {
                        xval.remove();
                        xval = null;
                    }
                }
            })  
        }); 
          
        function GetData(skin,yc) {
            //疫苗 
            var ymlist = new Array();
            $('#ymtable tr').each(function (i) {
                var yminfo = { ID: $(this).children().eq(2).children().attr("vid"), CODE: $(this).children().eq(0).text(), NAME: $(this).children().eq(1).text(), MANAGEMENT: $(this).children().eq(2).children().val(), FARM: $(this).children().eq(3).children().val() };
                ymlist.push(yminfo);
            });
            //饲料 sltbale
            var sllist = new Array();
            $('#sltbale tr').each(function (i) {
                var slinfo = { ID: $(this).children().eq(1).children().attr("vid"), FEED: $(this).children().eq(0).text(), FEEDFAC: $(this).children().eq(1).children().val(), MANAGEMENT: $(this).children().eq(2).children().val(), FARM: $(this).children().eq(3).children().val() };
                sllist.push(slinfo);
            });  
            // 猪苗  ZMCB  ZMHT
            var zmlist = { MANAGEMENT: $('#ZMCB').val(), FARM: $('#ZMHT').val() };
            // 药品  YPCB  YPHT
            var yplist = { MANAGEMENT: $('#YPCB').val(), FARM: $('#YPHT').val() };
            // 成品  CPSC  CPHT
            var zzlist = { MARKET: $('#CPSC').val(), CONTRACT: $('#CPHT').val() };
            //项目   进猪数量   代养费   死淘   一级
            var rllist = { PIGLETQTY: $('#yzNum').val(), ADJUSTFEE: $('#yzDYF').val(), CULLINGRATE: $('#yzSTL').val(), PERFECTRATE: $('#yzYDL').val(), NOPERFRATE: $('#noRa').val(), NOPERFWGTRATE: $('#noWGT').val() };

            $.ajax({
                type: "Post",
                url: "/api/STD/EditProject",
                dataType: 'json',  //项目 饲料 疫苗  小猪  成品猪  药品
                data: { PBE_PROJECTINFO: rllist, PBE_FEEDCOSTList: sllist, PBE_VACCINECOSTList: ymlist, PBE_PIGLETCOSTINFO: zmlist, PBE_PIGMARKETPRICEINFO: zzlist, PBE_MEDICINECOSTINFO: yplist, User: $.cookie('loginUserYC'), Skin: skin },
                beforeSend: function () {
                    if (!xval) {
                        GetAjaxLoad("", "");
                    }
                },
                success: function (data) {
                    projectID = data.data; 
                    ShowProjectList();
                    if (yc==1) {  //保存并预测
                        ShowTB(data.data);
                    }
                },
                complete: function () {
                    if (xval) {
                        xval.remove();
                        xval = null;
                    }
                }
            })

        }
        
        function ShowProject(nowpage,pagenum)
        {
            if ($.cookie('loginUserYC') == "admin") {
                $('#cjz').show();
            }
            else {
                $('#cjz').hide();
            }
            $.ajax({
                type: "Post",
                url: "/api/STD/ProjectList",
                dataType: 'json',
                data: { USER1: $.cookie('loginUserYC'), INDAY: nowpage, OUTDAY: pagenum },
                beforeSend: function(){
                    if (!xval) {
                        GetAjaxLoad("", "");
                    }
                },
                success: function (data) {  
                    var xmhtml = "";
                    var xmlist = data.data; 
                    for (var i = 0; i < xmlist.length; i++) {
                        if ($.cookie('loginUserYC') == "admin") {
                            xmhtml += "<tr> " +
                                "<td>" + xmlist[i].PROJECT + "</td>" +
                                "<td>" + formatDate(xmlist[i].INDATE) + "</td> " +
                                 "<td>" + xmlist[i].USER1 + "</td> " +
                                "<td>" + xmlist[i].PIGLETQTY + "</td> " +
                                "<td><a href='javascript:;' onclick='ShowDetail(\"" + xmlist[i].PROJECT + "\")'>详情</a></td>" +
                                "<td><a href='javascript:;' onclick='ShowTB(\"" + xmlist[i].PROJECT + "\")'>利润测算</a></td>" +
                                "</tr> ";
                        }
                        else {
                            xmhtml += "<tr> " +
                                "<td>" + xmlist[i].PROJECT + "</td>" +
                                "<td>" + formatDate(xmlist[i].INDATE) + "</td> " +
                                "<td>" + xmlist[i].PIGLETQTY + "</td> " +
                              "<td><a href='javascript:;' onclick='ShowDetail(\"" + xmlist[i].PROJECT + "\")'>详情</a></td>" +
                                "<td><a href='javascript:;' onclick='ShowTB(\"" + xmlist[i].PROJECT + "\")'>利润测算</a></td>" +
                                "</tr> ";
                        } 
                    }
                    $('#xmlist').html(xmhtml);
                },
                complete: function () {
                    if (xval) {
                        xval.remove();
                        xval = null;
                    }
                }
            })  
        }
        
        ShowProjectList();
        function ShowProjectList() {
            $.ajax({
                type: "Post",
                url: "/api/STD/ProjectAll",
                dataType: 'json',
                data: {USER1: $.cookie('loginUserYC') },
                beforeSend: function(){
                    if (!xval) {
                        GetAjaxLoad("", "");
                    }
                },
                success: function (data) {  
                    numall = data.data;  //总数据量 
                    if (numall == 0) {
                        if (xval) {
                            xval.remove();
                            xval = null;
                        }
                    }
                    else {
                        var allpage = Math.ceil(numall / pageshownum);
                        ShowPage("#fyshow", 1, allpage, shownowpage);   //ul ID 当前选中页码 总页数 回调函数 
                        ShowProject(1, pageshownum);
                    } 
                } 
                
            }) 
        }
        function shownowpage(page) {
            ShowProject(page, pageshownum)
        }
        //保存项目并预测
        $("#btnShowTB").click(function () { 
            $('#showXM').modal('hide');
            GetData(NEWORADD,1); 
        });
         
        //重新预测
        $("#btnYC").click(function () { 
            //获取id
            $.ajax({
                type: "Post",
                url: "/api/STD/EditShowProfit",
                dataType: 'json',  
                data: { PROJECT: projectID, CULLINGRATE: $("#yzSTL1").val(), PERFECTRATE: $("#yzYDL1").val(), NOPERFRATE: $("#noRa1").val() },
                beforeSend: function () {
                    if (!xval) {
                        GetAjaxLoad("", "");
                    }
                },
                success: function (data) {
                    var p = data.data.plist;
                    var pm = data.data.pm;

                    data = data.data.slist; 
                    $("#yzSTL1").val(p.CULLINGRATE);
                    $("#yzYDL1").val(p.PERFECTRATE);
                    $("#noRa1").val(pm.MARKET);
                    var result =
                    [{
                        name: '成本',
                        data: [parseInt(data[0][1]), parseInt(data[3][1]), parseInt(data[6][1])]
                    }, {
                        name: '收入',
                        data: [parseInt(data[1][1]), parseInt(data[4][1]), parseInt(data[7][1])]
                    }, {
                        name: '利润',
                        data: [parseInt(data[2][1]), parseInt(data[5][1]), parseInt(data[8][1])]
                    }];
                    ShowYC(projectID, result, parseInt(data[2][1]) + parseInt(data[5][1]));
                },
                complete: function () {
                    if (xval) {
                        xval.remove();
                        xval = null;
                    }
                }
            }) 
        });
        
        //生长标准
        $("#btn_slbz").click(function () {
            $.ajax({
                type: "Post",
                url: "/api/STD/SZBZList",
                dataType: 'json',
                beforeSend: function(){
                    if (!xval) {
                        GetAjaxLoad("", "");
                    }
                },
                success: function (data) { 
                    data = data.data;
                    var content = "";
                    for (var i = 0; i < data.length; i++) {
                        content += "<tr><td>" + data[i]["DAYS"] + "</td><td>" + data[i]["PIG_WGT"] +
                            "</td><td>" + data[i]["PIG_WGTINC"] + "</td><td>" + data[i]["FEED"] +
                            "</td><td>" + data[i]["FEED_WGT"] + "</td><td>" + data[i]["FEED_WGTINC"] + "</td></tr>"
                    }
                    $('#szqxtr').html(content); 
                },
                complete: function () {
                    if (xval) {
                        xval.remove();
                        xval = null;
                    }
                }
            })
            $('#showSZBZ').modal('show');
        });
        //项目详情
        function ShowDetail(PID) {
            NEWORADD = PID;
            $('#showXM').modal({ backdrop: "static" });
            $.ajax({
                type: "Post",
                url: "/api/STD/ProjectDetail",
                dataType: 'json',
                data: { PROJECT: PID },
                beforeSend: function () {
                    if (!xval) {
                        GetAjaxLoad("", "");
                    }
                },
                success: function (data) { 
                    //饲料数据
                    var slhtml = "";
                    var sllist = data.data.sllist;
                    for (var i = 0; i < sllist.length; i++) {
                        slhtml += "<tr>" +
                                " <td>" + sllist[i].FEED + "</td>" +
                                "<td style='padding:0px;'><input  type='text' value='" + sllist[i].FEEDFAC + "' class='form-control'></td>" +
                                "<td style='padding:0px;'><input  type='text' value='" + sllist[i].MANAGEMENT + "' class='form-control'></td>" +
                                "<td style='padding:0px;'><input  type='text'  value='" + sllist[i].FARM + "' class='form-control'></td>" +
                                "</tr> ";
                    }
                    $('#sltbale').html(slhtml);
                    //疫苗数据
                    var ymlist = data.data.ymlist;
                    var ymhtml = "";
                    for (var i = 0; i < ymlist.length; i++) {
                        ymhtml += " <tr>" +
                                "<td>" + ymlist[i].CODE + "</td>" +
                                "<td>" + ymlist[i].NAME + "</td>" +
                                "<td style='padding:0px;'><input type='text' style='border:none; text-align:right;' value='" + ymlist[i].MANAGEMENT + "' class='form-control'></td>" +
                                "<td style='padding:0px;'><input type='text' style='border:none; text-align:right;' value='" + ymlist[i].FARM + "' class='form-control'></td>" +
                            "</tr> ";
                    }
                    $('#ymtable').html(ymhtml);
                    // 猪苗  ZMCB  ZMHT
                    $('#ZMCB').val(data.data.zmlist[0].MANAGEMENT);
                    $('#ZMHT').val(data.data.zmlist[0].FARM);
                    // 药品  YPCB  YPHT
                    $('#YPCB').val(data.data.yplist[0].MANAGEMENT);
                    $('#YPHT').val(data.data.yplist[0].FARM);
                    // 成品  CPSC  CPHT
                    $('#CPSC').val(data.data.zzlist[0].MARKET);
                    $('#CPHT').val(data.data.zzlist[0].CONTRACT);
                    //  进猪数量   代养费   死淘   一级
                    $('#yzNum').val(data.data.rllist[0].PIGLETQTY);
                    $('#yzDYF').val(data.data.rllist[0].ADJUSTFEE);
                    $('#yzSTL').val(data.data.rllist[0].CULLINGRATE);
                    $('#yzYDL').val(data.data.rllist[0].PERFECTRATE);
                    $('#noRa').val(data.data.rllist[0].NOPERFWGTRATE);
                    $('#noWGT').val(data.data.rllist[0].NOPERFPRICERATE);
                },
                complete: function () {
                    if (xval) {
                        xval.remove();
                        xval = null;
                    }
                }
            })
        }
        //预测
        function ShowTB(PID) {
            projectID = PID;
            $.ajax({
                type: "Post",
                url: "/api/STD/ShowProfit",
                dataType: 'json',
                data: { PROJECT: PID },
                beforeSend: function () {
                    if (!xval) {
                        GetAjaxLoad("", "");
                    }
                },
                success: function (data) {
                    var p = data.data.plist;
                    var pm = data.data.pm;
                    
                    data = data.data.slist; 
                    $("#yzSTL1").val(p.CULLINGRATE); 
                    $("#yzYDL1").val(p.PERFECTRATE);
                    $("#noRa1").val(pm.MARKET);
                    var result =
                    [{
                        name: '成本',
                        data: [parseInt(data[0][1]), parseInt(data[3][1]), parseInt(data[6][1])]
                    }, {
                        name: '收入',
                        data: [parseInt(data[1][1]), parseInt(data[4][1]), parseInt(data[7][1])]
                    }, {
                        name: '利润',
                        data: [parseInt(data[2][1]), parseInt(data[5][1]), parseInt(data[8][1])]
                    }];
                    ShowYC(PID ,result, parseInt(data[2][1]) + parseInt(data[5][1]));
                },
                complete: function () {
                    if (xval) {
                        xval.remove();
                        xval = null;
                    }
                }
            }) 
            $('#showLRYC').modal('show');
        } 
        //疫苗使用标准
        $("#btn_ymbz").click(function () { 
            $.ajax({
                type: "Post",
                url: "/api/STD/YMBZList",
                dataType: 'json',
                beforeSend: function(){
                    if (!xval) {
                        GetAjaxLoad("", "");
                    }
                },
                success: function (data) { 
                    data = data.data;
                    var content = "";
                    for (var i = 0; i < data.length; i++) {
                        content += "<tr><td>" + data[i]["DAYS"] + "</td><td>" + data[i]["VACCINE"] + "</td><td>" + data[i]["VARIETY"] + "</td><td>" + data[i]["QTY"] + "</td></tr>"
                    } 
                    $('#ymtr').html(content); 
                    $('#showYMBZ').modal('show'); 
                },
                complete: function () {
                    if (xval) {
                        xval.remove();
                        xval = null;
                    }
                }
            }) 
        }); 
        //死淘曲线
        $("#btn_stbz").click(function () {
            $.ajax({
                type: "Post",
                url: "/api/STD/SZBZList",
                dataType: 'json',
                beforeSend: function () {
                    if (!xval) {
                        GetAjaxLoad("", "");
                    }
                },
                success: function (data) { 
                    data = data.data;
                    var num1 = new Array();
                    for (var i = 0; i < data.length; i++) {
                        var num11 = new Array();
                        num11[0] = data[i]["DAYS"];
                        num11[1] = data[i]["OUTRATEDAY"];
                        num1.push(num11);
                    }
                    ShowTQQX(num1);
                },
                complete: function () {
                    if (xval) {
                        xval.remove();
                        xval = null;
                    }
                }
            }) 
            $('#showSTQX').modal('show');
        });
        function ShowTQQX(data) {
            var chart = Highcharts.chart('ttqx', {
                chart: {
                    type: 'areaspline'
                },
                title: {
                    text: '饲养过程淘汰规律'
                },
                exporting: {
                    enabled: false
                }, 
                legend: {
                    layout: 'vertical',
                    align: 'left',
                    verticalAlign: 'top',
                    x: 150,
                    y: 100,
                    floating: true,
                    borderWidth: 1,
                },
                xAxis: {
                    tickInterval: 20,
                    min: 21,
                    
                },
                yAxis: {
                    title: {
                        text: '%'
                    }
                },
                tooltip: {
                    shared: true,
                },
                plotOptions: {
                    areaspline: {
                        fillOpacity: 0.5
                    },
                    series: {
                        marker: {
                            lineWidth: 2,
                            radius: 3
                        }
                    }
                },
                series: [{
                    name: '淘汰率',
                    data: data
                }]
            });
        }
        function ShowYC(PID,data, all) {
            var chart = Highcharts.chart('lrtb', {
                chart: {
                    type: 'column'
                },
                title: {
                    text: PID +':各方成本收入利润预测'
                }, 
                subtitle: {
                    text: '饲料厂和养殖公司总利润（元）：' + Highcharts.numberFormat(all,0)  
                },
                exporting: {
                    enabled: false
                },
                xAxis: {
                    categories: ['饲料厂', '养殖公司', '代养户']
                },
                yAxis: {
                    title: { 
                        text: '金额'
                    }
                },
                plotOptions: {
                    stacking: 'normal', pointPadding: 0,
                    groupPadding: 0,
                    column: {
                        dataLabels: { 
                            enabled: true,
                            allowOverlap:true
                        }
                    }
                },
                series: data 
            });
        }
      
    </script>
</body>
</html>